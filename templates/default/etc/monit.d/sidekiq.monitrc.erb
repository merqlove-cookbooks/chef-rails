<% (@num_workers || 1).times do |num| %>
<% worker_suffix = @num_workers > 2 ? "_#{num}" : "" -%>
check process <%= @service_name %><%= worker_suffix %>
  with pidfile <%= @path %>/shared/tmp/pids/sidekiq<%= "_#{num}" || '' %>.pid
  start program = "/bin/systemctl start <%= @service_name %><%= worker_suffix %>" with timeout 90 seconds
  stop program = "/bin/systemctl stop <%= @service_name %><%= worker_suffix %>" with timeout 90 seconds
  if totalmem is greater than <%= @mem_limit || 300 %> MB for 2 cycles then restart # eating up memory?
  group <%= @service_name %>
<% end %>
